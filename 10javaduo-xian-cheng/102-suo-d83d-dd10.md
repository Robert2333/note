# 10.2 é”ğŸ”

---

#### public void lock\(\)

> è°ƒç”¨åä¸€ç›´é˜»å¡åˆ°è·å¾—é”

1. è·å–é”ã€‚

2. _**å¦‚æœè¯¥é”æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒï¼Œåˆ™è·å–è¯¥é”å¹¶ç«‹å³è¿”å›**_ï¼Œå°†é”çš„ä¿æŒè®¡æ•°è®¾ç½®ä¸º 1ã€‚

3. å¦‚æœå½“å‰çº¿ç¨‹å·²ç»ä¿æŒè¯¥é”ï¼Œåˆ™å°†ä¿æŒè®¡æ•°åŠ  1ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ç«‹å³è¿”å›ã€‚

4. å¦‚æœè¯¥é”è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒï¼Œåˆ™å‡ºäºçº¿ç¨‹è°ƒåº¦çš„ç›®çš„ï¼Œç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”åœ¨è·å¾—é”ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å°†ä¸€ç›´å¤„äºä¼‘çœ çŠ¶æ€ï¼Œæ­¤æ—¶é”ä¿æŒè®¡æ•°è¢«è®¾ç½®ä¸º 1ã€‚

---

#### public boolean tryLock\(\)

> å°è¯•æ˜¯å¦èƒ½è·å¾—é” å¦‚æœä¸èƒ½è·å¾—ç«‹å³è¿”å›ã€‚å¦‚æœé”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒï¼Œåˆ™è·å–é”ã€‚

1. ä»…åœ¨è°ƒç”¨æ—¶é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒçš„æƒ…å†µä¸‹ï¼Œæ‰è·å–è¯¥é”ã€‚

2. å¦‚æœè¯¥é”æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒï¼Œå¹¶ä¸”ç«‹å³è¿”å› true å€¼ï¼Œåˆ™å°†é”çš„ä¿æŒè®¡æ•°è®¾ç½®ä¸º 1ã€‚

3. å³ä½¿å·²å°†æ­¤é”è®¾ç½®ä¸ºä½¿ç”¨å…¬å¹³æ’åºç­–ç•¥ï¼Œä½†æ˜¯è°ƒç”¨ tryLock\(\) ä»å°† ç«‹å³è·å–é”ï¼ˆå¦‚æœæœ‰å¯ç”¨çš„ï¼‰ï¼Œè€Œä¸ç®¡å…¶ä»–çº¿ç¨‹å½“å‰æ˜¯å¦æ­£åœ¨ç­‰å¾…è¯¥é”ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ­¤â€œé—¯å…¥â€è¡Œä¸ºå¯èƒ½å¾ˆæœ‰ç”¨ï¼Œå³ä½¿å®ƒä¼šæ‰“ç ´å…¬å¹³æ€§ä¹Ÿå¦‚æ­¤ã€‚å¦‚æœå¸Œæœ›éµå®ˆæ­¤é”çš„å…¬å¹³è®¾ç½®ï¼Œåˆ™ä½¿ç”¨ tryLock\(0, TimeUnit.SECONDS\)ï¼Œå®ƒå‡ ä¹æ˜¯ç­‰æ•ˆçš„ï¼ˆä¹Ÿæ£€æµ‹ä¸­æ–­ï¼‰ã€‚

4. å¦‚æœå½“å‰çº¿ç¨‹å·²ç»ä¿æŒæ­¤é”ï¼Œåˆ™å°†ä¿æŒè®¡æ•°åŠ  1ï¼Œè¯¥æ–¹æ³•å°†è¿”å› trueã€‚

5. å¦‚æœé”è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒï¼Œåˆ™æ­¤æ–¹æ³•å°†ç«‹å³è¿”å› false å€¼ã€‚

6. æŒ‡å®šè€…ï¼š æ¥å£ Lock ä¸­çš„ tryLock

7. è¿”å›ï¼š å¦‚æœé”æ˜¯è‡ªç”±çš„å¹¶ä¸”è¢«å½“å‰çº¿ç¨‹è·å–ï¼Œæˆ–è€…å½“å‰çº¿ç¨‹å·²ç»ä¿æŒè¯¥é”ï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› false

---

ä»£ç ç¤ºä¾‹ï¼š

> Lock

```java
public class Test {
    //æ–°å»ºä¸€ä¸ªé”
    private Lock lock = new ReentrantLock();
    //ä¸€ä¸ªæ¡ä»¶ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªæ¡ä»¶
    Condition condition = lock.newCondition();

    int a = 5;

    public int test(int t) throws InterruptedException {
        //è·å–å¯¹è±¡é”
        lock.lock();
        while ((a + t) < 9) {
            //å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œè¿›å…¥ç­‰å¾…æ€
            condition.await();
        }
        try {
            a = a + t;
        } catch (Exception e) {

        } finally {
            //è§£é”
            lock.unlock();
            //é€šçŸ¥å…¶ä»–çº¿ç¨‹å¯ä»¥è¿›å…¥å°±ç»ªæ€
            condition.signalAll();
        }
        return a;
    }
}
```

---

> tryLock

```java
public class Test {
    //æ–°å»ºä¸€ä¸ªé”
    private Lock lock = new ReentrantLock();
    //ä¸€ä¸ªæ¡ä»¶ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªæ¡ä»¶
    Condition condition = lock.newCondition();

    int a = 5;

    public int test(int t) throws InterruptedException {
        //è·å–å¯¹è±¡é”
       if(lock.tryLock()){
           //è·å¾—äº†é”ï¼Œæ‰§è¡Œä»£ç 
           try{
               
           }finally {
               lock.unlock();//è§£é”
           }
       }else {
           //æ²¡æœ‰è·å¾—é”çš„å…¶ä»–æ“ä½œ
       }
       
       return a;
    }
}

```



